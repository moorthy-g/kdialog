/*** kDialog v0.0.2-beta
A Facebook Friendly dialog, made to comply with awesome CSS & JS animations
email: moorthy.g@krds.com ***/
!function(a){"function"==typeof define&&define.amd?define(["jquery"],a):a(jQuery)}(function(a){"use strict";function b(b,c){this.element=b,this.wrapper=null,this.isOpen=!1,this.busy=!1,this.settings=a.extend({},d,c),this.id=0,this.init()}var c="kdialog",d={css:"animation",modal:!0,actionHandlers:{},wrapperClass:"kdefault",position:["auto","auto"],watchForResize:!1,easyClose:!1,transitFrom:null,transitTo:null,beforeOpen:function(){},beforeClose:function(){},open:function(){},close:function(){}};b.prototype=function(){var b,c,d,e="animationend webkitAnimationEnd mozAnimationEnd",f="transitionend webkitTransitionEnd mozTransitionEnd",g="onorientationchange"in window?"orientationchange":"resize",h=0,i=0,j=20,k=/android [1-2\.]/i.test(navigator.userAgent.toLowerCase()),l=function(){var a=["webkit","moz"],d=document.createElement("p").style;void 0!==d.animation&&(b="animation"),void 0!==d.transition&&(c="transition");for(var e,f=0;(f<a.length,e=a[f])&&(!b||!c);f++)void 0!==d[e+"Animation"]&&(b=e+"Animation"),void 0!==d[e[f]+"Transition"]&&(c=e+"Transition")},m=function(){this.busy=!1,this.settings.open.call(this)},n=function(){this.wrapper.setAttribute("style",""),this.wrapper.removeAttribute("style"),this.busy=!1,this.isOpen=!1,this.settings.modal&&--i<1&&a(d).fadeOut(200),this.settings.close.call(this)},o=function(){if(this.isOpen||this.settings.position){var a=this.settings.position[0],b=this.settings.position[1],c=this.wrapper;window.Env&&"canvas"==window.Env.fb.mode&&null!=b?p.call(this,b):null!=b?("auto"==b&&(b=(document.documentElement.clientHeight-c.clientHeight)/2,b=j>b?j:b),c.style.top=b+(document.documentElement.scrollTop||document.body.scrollTop)+"px"):this.busy||(c.style.top=""),null!=a?(a="auto"==a?(document.documentElement.clientWidth-c.clientWidth)/2:a,c.style.left=a+(document.documentElement.scrollLeft||document.body.scrollLeft)+"px"):this.busy||(c.style.left="")}},p=function(a){var b,c,d,e,f,g,h,i=document.documentElement.clientHeight,k=this.wrapper,l=50,m=389,n=10;window.FB.Canvas.getPageInfo(function(o){g=810===document.documentElement.clientWidth,h=g?o.offsetTop-m:0,h-=h>l?n:0,b=o.offsetTop-o.scrollTop-h,c=0>b?Math.abs(b):0,d=(0>b?o.clientHeight+c:o.clientHeight-b)-h,d=d>i?i:d,"auto"==a&&(e=d-c,f=k.clientHeight,a=e>=f?(e-f)/2:c+f>i?e-f-j:j),k.style.top=a+c+"px"})},q=function(){var b,c=this,e=this.element;c.settings.modal&&!d&&(d=document.createElement("div"),d.className="koverlay",document.body.appendChild(d)),b=this.wrapper=document.createElement("div"),b.className="kwrapper "+(c.settings.wrapperClass||"kdefault"),b.appendChild(e),document.body.appendChild(b),e.style.display="block",a(b).on("click","[data-action]",function(a){a.preventDefault();var b=this.getAttribute("data-action");"close"===b?s.call(c):(b=c.settings.actionHandlers[b])&&b.call(c,a)}),c.id=h++},r=function(){if(!this.isOpen&&!this.busy){var h,j=this,l=this.element,n=a(l);if(j.busy=!0,j.isOpen=!0,j.wrapper.style.display="block",o.call(j),j.settings.beforeOpen.call(j),j.settings.modal&&(i++,a(d).fadeIn(200)),"animation"===j.settings.css&&!k&&b)n.addClass("in"),h=b+"Name","none"!=window.getComputedStyle(l)[h]?n.on(e,function(){n.off(e),n.removeClass("in"),m.call(j)}):(n.removeClass("in"),m.call(j));else if("transition"===j.settings.css&&!k&&c){var p=j.settings.transitFrom,q=j.settings.transitTo;n.on(f,function(){n.off(f),n.removeClass("transition"),m.call(j)}),p&&q?(n.css(p),setTimeout(function(){n.addClass("transition").css(q)},10)):(n.addClass("from"),setTimeout(function(){n.addClass("transition").removeClass("from")},10))}else m.call(j);j.settings.easyClose&&(a(document).on("keyup.kdid"+j.id,function(a){27==a.which&&s.call(j)}),d&&a(d).on("click.kdid"+j.id,function(){s.call(j)})),j.settings.watchForResize&&a(window).on(g+".kdid"+j.id,function(){o.call(j)})}},s=function(){if(this.isOpen&&!this.busy){var h,i=this,j=this.element,l=a(j);if(i.busy=!0,i.settings.beforeClose.call(i),i.settings.easyClose&&(a(document).off("keyup.kdid"+i.id),d&&a(d).off("click.kdid"+i.id)),i.settings.watchForResize&&a(window).off(g+".kdid"+i.id),"animation"===i.settings.css&&!k&&b)l.addClass("out"),h=b+"Name","none"!=window.getComputedStyle(j)[h]?l.on(e,function(){l.off(e).removeClass("out"),n.call(i)}):(l.removeClass("out"),n.call(i));else if("transition"===i.settings.css&&!k&&c){{var m=i.settings.transitFrom;i.settings.transitTo}l.on(f,function(){l.off(f),l.removeClass("transition from"),m&&(j.setAttribute("style",""),j.removeAttribute("style"),j.style.display="block"),n.call(i)}),l.addClass("transition"),m?l.css(m):l.addClass("from")}else n.call(i)}},t=function(b,c){var d=this.settings,e=this.wrapper;b&&(a.extend(d,b),e&&(e.className="kwrapper "+(d.wrapperClass||"kdefault"))),"close"!==c&&o.call(this)},u=function(){var a=this,b=this.wrapper;a.close(),b.parentNode.removeChild(b),--h<1&&d?(d.parentNode.removeChild(d),d=null):d&&(d.style.display="none")};return l(),{init:q,open:r,close:s,refresh:t,destroy:u}}(),a.fn[c]=function(){for(var d,e,f,g=0;f=arguments[g],2>g;g++)"object"==typeof f?e=f:"string"==typeof f&&(d=f);return this.each(function(){var f=a.data(this,c);f?f.refresh(e,d):f=a.data(this,c,new b(this,e)),d&&"refresh"!=d&&(d=f[d])&&d.call(f)})}});