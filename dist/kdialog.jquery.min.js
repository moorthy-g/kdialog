/*** kDialog v0.0.1-beta
A Facebook Friendly dialog, made to comply with awesome CSS & JS animations
email: moorthy.g@krds.com ***/
!function(a){"function"==typeof define&&define.amd?define(["jquery"],a):a(jQuery)}(function(a){"use strict";function b(b,c){return this.element=b,this.isOpen=!1,this.busy=!1,this.settings=a.extend({},d,c),this.id=0,this.init(),this}var c="kdialog",d={css:"animation",modal:!0,actionHandlers:{},wrapperClass:null,position:["auto","auto"],easyClose:!1,transitFrom:null,transitTo:null,beforeOpen:function(){},beforeClose:function(){},open:function(){},close:function(){}};b.prototype=function(){var b,d,e,f,g,h=0,i=0,j=20,k=/android [1-2\.]/i.test(navigator.userAgent.toLowerCase()),l=function(a){var b=["webkit","moz","MS"],c=document.createElement("p");if(""==c.style[a])return a;a=a.charAt(0).toUpperCase()+a.slice(1);for(var d=0;d<b.length;d++)if(""==c.style[b[d]+a])return b[d]+a},m=function(){b=l("animation"),d=l("transition"),b&&(e=b+("animation"===b?"end":"End")),d&&(f=d+("transition"===d?"end":"End"))},n=function(){this.busy=!1,this.settings.open.call(this)},o=function(){this.$wrapper.removeAttr("style"),this.busy=!1,this.isOpen=!1,this.settings.modal&&--i<1&&g.fadeOut(200),this.settings.close.call(this)},p=function(){if(this.isOpen){var a=this.settings.position[0],b=this.settings.position[1];window.Env&&"canvas"==window.Env.fb.mode&&null!=b?q.call(this,b):null!=b&&("auto"==b&&(b=(document.documentElement.clientHeight-this.$wrapper.height())/2,b=j>b?j:b),this.$wrapper.css("top",b+(document.documentElement.scrollTop||document.body.scrollTop))),null!=a&&(a="auto"==a?(document.documentElement.clientWidth-this.$wrapper.width())/2:a,this.$wrapper.css("left",a+(document.documentElement.scrollLeft||document.body.scrollLeft)))}},q=function(a){var b,c,d,e,f,g,h,i=this,k=document.documentElement.clientHeight,l=50,m=389,n=10;window.FB.Canvas.getPageInfo(function(o){g=810===document.documentElement.clientWidth,h=g?o.offsetTop-m:0,h-=h>l?n:0,b=o.offsetTop-o.scrollTop-h,c=0>b?Math.abs(b):0,d=(0>b?o.clientHeight+c:o.clientHeight-b)-h,d=d>k?k:d,"auto"==a&&(e=d-c,f=i.$wrapper.height(),a=e>=f?(e-f)/2:c+f>k?e-f-j:j),i.$wrapper.css("top",a+c)})},r=function(){var b=this,c=a(this.element);b.settings.modal&&!g&&(g=a("<div class='koverlay'></div>"),g.insertBefore(c)),k&&(this.settings.css=null),c.wrap("<div class='kwrapper"+(b.settings.wrapperClass?" "+b.settings.wrapperClass:"")+"'></div>"),b.$wrapper=c.parent(),c.show(),b.$wrapper.on("touchstart click","[data-action]",function(a){a.preventDefault();var c=this.getAttribute("data-action");"close"===c?t.call(b):(c=b.settings.actionHandlers[c])&&c.call(b,a)}),b.id=h++},s=function(){if(!this.isOpen&&!this.busy){var c,d=this,h=a(d.element);if(d.busy=!0,d.isOpen=!0,d.$wrapper.show(),d.settings.position&&p.call(d),d.settings.beforeOpen.call(d),d.settings.modal&&(i++,g.fadeIn(200)),"animation"===d.settings.css&&e)h.addClass("in"),c=b+"Name","none"!=h.css(c)?h.on(e,function(){h.off(e),h.removeClass("in"),n.call(d)}):(h.removeClass("in"),n.call(d));else if("transition"===d.settings.css&&f){var j=d.settings.transitFrom,k=d.settings.transitTo;h.on(f,function(){h.off(f),h.removeClass("transition"),n.call(d)}),j&&k?(h.css(j),setTimeout(function(){h.addClass("transition").css(k)},10)):(h.addClass("from"),setTimeout(function(){h.addClass("transition").removeClass("from")},10))}else n.call(d);d.settings.easyClose&&(a(document).on("keyup.kdid"+d.id,function(a){27==a.which&&t.call(d)}),g.on("click.kdid"+d.id,function(){t.call(d)}))}},t=function(){if(this.isOpen&&!this.busy){var c,d=this,h=a(d.element);if(d.busy=!0,d.settings.beforeClose.call(d),d.settings.easyClose&&(a(document).off("keyup.kdid"+d.id),g.off("click.kdid"+d.id)),"animation"===d.settings.css&&e)h.addClass("out"),c=b+"Name","none"!=h.css(c)?h.on(e,function(){h.off(e).removeClass("out"),o.call(d)}):(h.removeClass("out"),o.call(d));else if("transition"===d.settings.css&&f){{var i=d.settings.transitFrom;d.settings.transitTo}h.on(f,function(){h.off(f),h.removeClass("transition from"),i&&h.removeAttr("style").show(),o.call(d)}),h.addClass("transition"),i?h.css(i):h.addClass("from")}else o.call(d)}},u=function(b){b&&a.extend(this.settings,b),k&&(this.settings.css=null),p.call(this)},v=function(){var b=this;b.close(),a(b.element).unwrap().hide().data(c,null),b.$wrapper.off("touchstart click"),--h<1&&g?(g.remove(),g=null):g&&g.hide()};return m(),{init:r,open:s,close:t,refresh:u,destroy:v}}(),a.fn[c]=function(){for(var d,e,f,g=0;f=arguments[g],2>g;g++)"object"==typeof f?e=f:"string"==typeof f&&(d=f);return this.each(function(){var f=a.data(this,c)||a.data(this,c,new b(this,e));f.refresh(e),d&&"refresh"!=d&&(d=f[d])&&d.call(f)})}});