/*** kDialog v0.0.1-alpha
A Facebook Friendly dialog, made to comply with awesome CSS & JS animations
email: moorthy.g@krds.com ***/
!function(a,b,c){"use strict";function d(b,c){return this.element=b,this.isOpen=!1,this.settings="object"==typeof c?a.extend(f,c):f,this.init(),this}var e="kdialog",f={css:"transition",modal:!0,actionHandlers:{},wrapperClass:null,position:["auto","auto"],transitFrom:null,transitTo:null,beforeOpen:function(){},beforeClose:function(){},open:function(){},close:function(){}};d.prototype=function(){var d,f,g,h,i,j=!1,k=0,l=20,m=function(a){var b=["webkit","moz","MS"],d=c.createElement("p");if(""==d.style[a])return a;a=a.charAt(0).toUpperCase()+a.slice(1);for(var e=0;e<b.length;e++)if(""==d.style[b[e]+a])return b[e]+a},n=function(){d=m("animation"),f=m("transition"),d&&(g=d+("animation"===d?"end":"End")),f&&(h=f+("transition"===f?"end":"End"))},o=function(){j=!1,this.settings.open.call(this)},p=function(){this.$wrapper.hide(),j=!1,this.isOpen=!1,this.settings.modal&&i.fadeOut(200),this.settings.close.call(this)},q=function(a){var d,e,f,g,h,i,j,k=this,m=c.documentElement.clientHeight,n=50,o=389,p=10;b.FB.Canvas.getPageInfo(function(b){i=810===c.documentElement.clientWidth,j=i?b.offsetTop-o:0,j-=j>n?p:0,d=b.offsetTop-b.scrollTop-j,e=0>d?Math.abs(d):0,f=(0>d?b.clientHeight+e:b.clientHeight-d)-j,f=f>m?m:f,"auto"==a&&(g=f-e,h=k.$wrapper.height(),a=g>=h?(g-h)/2:e+h>m?g-h-l:l),k.$wrapper.css("top",a+e)})},r=function(){var b=this,c=a(this.element);b.settings.modal&&!i&&(i=a("<div class='koverlay'></div>"),i.insertBefore(c)),c.wrap("<div class='kwrapper"+(b.settings.wrapperClass?" "+b.settings.wrapperClass:"")+"'></div>"),b.$wrapper=c.parent(),c.show(),b.$wrapper.on("touchstart click","[data-action]",function(a){a.preventDefault();var c=this.getAttribute("data-action");"close"===c?t.call(b):b.settings.actionHandlers[c].call(b)}),/android [1-2\.]/i.test(navigator.userAgent.toLowerCase())&&(b.settings.css=null),k++},s=function(){if(!this.isOpen&&!j){var b,c=this,e=a(c.element);if(j=!0,c.isOpen=!0,c.settings.beforeOpen.call(c),c.$wrapper.show(),c.settings.position&&c.position(this.settings.position[0],this.settings.position[1]),c.settings.modal&&i.fadeIn(200),"animation"===c.settings.css&&g)e.addClass("in"),b=d+"Name","none"!=e.css(b)?e.on(g,function(){e.off(g),e.removeClass("in"),o.call(c)}):(e.removeClass("in"),o.call(c));else if("transition"===c.settings.css&&h){var f=c.settings.transitFrom,k=c.settings.transitTo;e.on(h,function(){e.off(h),e.removeClass("transition"),o.call(c)}),f&&k?(e.css(f),setTimeout(function(){e.addClass("transition").css(k)},10)):(e.addClass("from"),setTimeout(function(){e.addClass("transition").removeClass("from")},10))}else o.call(c)}},t=function(){if(this.isOpen&&!j){var b,c=this,e=a(c.element);if(j=!0,c.settings.beforeClose.call(c),"animation"===c.settings.css&&g)e.addClass("out"),b=d+"Name","none"!=e.css(b)?e.on(g,function(){e.off(g).removeClass("out"),p.call(c)}):(e.removeClass("out"),p.call(c));else if("transition"===c.settings.css&&h){var f=c.settings.transitFrom,i=c.settings.transitTo;e.on(h,function(){var b={};if(e.off(h),e.removeClass("transition from"),i){for(var d in a.extend(f,i))b[d]="";e.css(b)}p.call(c)}),e.addClass("transition"),f?e.css(f):e.addClass("from")}else p.call(c)}},u=function(a,d){this.isOpen&&(b.FB&&b.FB.Canvas&&d?q.call(this,d):d&&("auto"==d&&(d=(c.documentElement.clientHeight-this.$wrapper.height())/2,d=l>d?l:d),this.$wrapper.css("top",d+c.body.scrollTop)),a&&(a="auto"==a?(c.documentElement.clientWidth-this.$wrapper.width())/2:a,this.$wrapper.css("left",a+c.body.scrollLeft)))},v=function(){var b=this;a(this.element).unwrap().hide().data(e,null),b.$wrapper.off("touchstart click"),--k<1&&i?(i.remove(),i=null):i&&i.hide()};return n(),{init:r,open:s,close:t,position:u,destroy:v}}(),a.fn[e]=function(){for(var c,f,g,h=0;g=arguments[h],2>h;h++)"object"==typeof g?f=g:"string"==typeof g&&(c=g);return this.each(function(){a.data(this,e)||a.data(this,e,new d(this,f));try{var g=a.data(this,e);f&&a.extend(g.settings,f),c&&g[c]()}catch(h){b.console}})}}(jQuery,window,document);